import{x as i}from"./index-Bk8oHQ_M.js";const l=i("focus",{state:()=>({records:(()=>{try{return localStorage.getItem("focus_records")?JSON.parse(localStorage.getItem("focus_records")):c()}catch(t){return console.warn("Failed to load records from localStorage",t),c()}})()}),actions:{addRecord(t){const e={...t};e.isSpecialEvent||(e.specialEventContent=""),this.records.unshift({...e,id:Date.now()+Math.random().toString(36).substr(2,9)}),this.saveToLocal()},deleteRecord(t){confirm("确定要删除这条记录吗？")&&(this.records=this.records.filter(e=>e.id!==t),this.saveToLocal())},saveToLocal(){localStorage.setItem("focus_records",JSON.stringify(this.records))},exportToMarkdown(){let t=`# 专注时间记录归档

生成时间: ${new Date().toLocaleString()}

`;t+=`| 日期 | 时长(h) | 假期 | 特殊事件 | 事件内容 | 描述 |
`,t+=`|---|---|---|---|---|---|
`,this.sortedRecords.forEach(e=>{const s=e.isSpecialEvent?e.specialEventContent||"未填写":"-";t+=`| ${e.date} | ${e.hours} | ${e.isHoliday?"是":"否"} | ${e.isSpecialEvent?"是":"否"} | ${s} | ${e.description} |
`}),t+=`
## 统计摘要
`,t+=`- 总记录数: ${this.records.length} 条
`,this.downloadFile(t,"focus_records.md","text/markdown")},exportToJson(){const t=JSON.stringify(this.records,null,2);this.downloadFile(t,"focus_records.json","application/json")},importFromJson(t){const e=new FileReader;e.onload=s=>{try{const r=s.target?.result;if(typeof r!="string")throw new Error("文件读取失败");const o=JSON.parse(r);if(!Array.isArray(o))throw new Error("JSON 根节点必须是数组");const a=[];for(const n of o)typeof n.date=="string"&&typeof n.hours=="number"&&typeof n.description=="string"&&typeof n.isHoliday=="boolean"&&typeof n.isSpecialEvent=="boolean"&&typeof n.specialEventContent=="string"&&a.push({...n,id:Date.now()+Math.random().toString(36).substring(2,10)});if(a.length===0){alert("未找到有效记录！");return}this.records.push(...a),this.saveToLocal(),alert(`成功导入 ${a.length} 条记录！`)}catch(r){console.error("导入失败:",r),alert("导入失败：文件格式不正确或内容无效")}},e.readAsText(t)},clearAll(){this.records=[],this.saveToLocal()},downloadFile(t,e,s){const r=new Blob([t],{type:s}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}},getters:{sortedRecords:t=>[...t.records].sort((e,s)=>Number(new Date(s.date))-Number(new Date(e.date))),chartData:t=>{const e={};t.records.forEach(o=>{e[o.date]||(e[o.date]=0),e[o.date]=(e[o.date]||0)+Number(o.hours)});const s=Object.keys(e).sort(),r=s.map(o=>e[o]);return{labels:s,data:r}}}}),c=()=>{const t=[],e=["阅读Vue文档","项目代码重构","算法练习","团队周会","修复Bug","学习WebGL"],s=["版本发布","线上故障排查","季度规划会","Hackathon"];for(let r=0;r<7;r++){const o=new Date;o.setDate(o.getDate()-r);const a=Math.random()>.7;t.push({id:Date.now()-r*1e3,date:o.toISOString().split("T")[0],hours:Number((Math.random()*8+1).toFixed(1)),description:e[Math.floor(Math.random()*e.length)],isHoliday:r%6===0,isSpecialEvent:a,specialEventContent:a?s[Math.floor(Math.random()*s.length)]:""})}return t.reverse()};export{l as u};
